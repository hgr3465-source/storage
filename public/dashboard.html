<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Inventory Dashboard</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
  <h1 class="mb-4 text-center">لوحة التحكم - المخزون والمبيعات</h1>

  <!-- Login -->
  <div id="loginForm">
    <h3>تسجيل الدخول</h3>
    <input id="username" class="form-control mb-2" placeholder="اسم المستخدم">
    <input id="password" type="password" class="form-control mb-2" placeholder="كلمة المرور">
    <button class="btn btn-primary" onclick="login()">دخول</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" style="display:none">
    <h3>الإحصائيات</h3>
    <canvas id="statsChart" width="400" height="150"></canvas>

    <h3 class="mt-4">المنتجات</h3>
    <table class="table table-bordered" id="productsTable">
      <thead>
        <tr><th>ID</th><th>الاسم</th><th>السعر</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
async function login(){
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;
  const res = await fetch("/api/login",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password})
  });
  const data = await res.json();
  if(data.success){
    document.getElementById("loginForm").style.display="none";
    document.getElementById("dashboard").style.display="block";
    loadProducts();
    loadStats();
  }else{
    alert("خطأ في اسم المستخدم أو كلمة المرور");
  }
}

async function loadProducts(){
  const res = await fetch("/api/products");
  const products = await res.json();
  const tbody = document.querySelector("#productsTable tbody");
  tbody.innerHTML="";
  products.forEach(p=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${p.id}</td><td>${p.name}</td><td>${p.price}</td>`;
    tbody.appendChild(tr);
  });
}

async function loadStats(){
  const res = await fetch("/api/stats");
  const stats = await res.json();
  const ctx = document.getElementById('statsChart').getContext('2d');
  new Chart(ctx,{
    type:'bar',
    data:{
      labels:['المنتجات','إجمالي المبيعات'],
      datasets:[{
        label:'إحصائيات',
        data:[stats.totalProducts,stats.totalSales],
        backgroundColor:['#007bff','#28a745']
      }]
    }
  });
}
</script>

</body>
</html>
